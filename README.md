## 마이크로 서비스 이점 
- 기술적 자유 
- 재사용 가능한 코드 
- 복원성

## 마이크로 서비스를 위한 조건 

프로젝트 규모가 작은 경우, 모놀리식 아키텍처로 사용하고 점차 발전할수록 아래 기준으로 MSA 아키 텍처로 전환하는 것이 좋다.

1. 비용 : MSA 아키텍처를 도입할 경우，모놀리식 아키텍처에 비해 비용을 얼마나 절감할 수 있는가?

2. 개발생산성: 마이크로 서비스를 요구할 만큼 시스템 복잡도가 높은가? 또는 복잡도를 지나치게 높인 마이크로 서비스가 생산성몰 저해하고 있진 않은가?

3. 운영: 개발 팀에게 개발과 운영을 동시에 할 만묻 인프라가 준비되어 있는가? 또는 개발 인력이 마이크로 서비스룹 관리할 역랑이 있는가?
(인프라가 준비되어있는가)

4. 배포: 배포를 충분히 자주 하고 있는가? MSA는 빠론 변화에 대응하기 위해 도입하는 것인데, 회사마다 배포 일이 정해져 있고，배포가 가끔 일어난다면 효율이 떨어진다.

선배님 마이크로 서비스가 좋은건 알겠는데 현실적으로 위에 조건을 고려해보면 좋겠습니다. 
무작정 MSA를 쓰는 것은 아니다. 

마이크서비스를 위한 조건

## Monolithic vs SOA vs Microservice 

모놀리틱 - 소스코드가 모드 들어가 있다.
- SOA 
많온 사람들이 마이크로 서비스를 SOA (Service-Oriented Architecture)의 또 다른 이름으로 혼동하지만, 전통적인 SOA가 더 광범위한 프레임 워크이며 다양한 것을 의미 할 수 있습니다.
둘 다 서비스를 주요 구성 요소로 사용하지만 서비스 특성 촉면에서 크게 다릅니다.
SOA 모델은 종속적인 ESB를 가지고 있습니다. SOA는 또한 명령형 프로그래밍을 강조하는 반면 마 이크로 서비스 아키텍처는 반응 형 액터 프로그래밍 스타일에 중점을 둡니다.

**서비스 지향 아키텍처에서 ESB란 무엇인가요?**
엔터프라이즈 서비스 버스(ESB)는 여러 서비스가 있는 시스템과 롱신할 때 사용할 수 있는 소프트웨 
어로서, 기술에 관계없이 서비스악 서비스 소비자 간의 롱신을 설정합니다.


ESB의 이점

ESB는 재사용 가능한 서비스 인터페이스를 통해 통신 및 변환 기능을 제공합니다. ESB는 서비스 요청을 적절한 서비스로 라우팅하는 중앙 집중식 서비스에 비유할 수 있습니다. 또한 요청을 서비스의 기본 플랫폼 및 프로그래밍 언어에 허용되는 형식으로 변환합니다.

## Monolithic architecture
소프트웨어 공학에서 모놀리식 패턴온 하나의 분할 할 수없는 단위를 나타냅니다.
모놀리식 소프트웨어의 개념은 단일 플랫폼에서 단일 프로그램으로 결합되는 응용 프로그램의 여러 구성 요소에 있습니다. 일반적으로 모놀리식 응용 프로그램은 데이터베이스, 클라이언트 측 사용자 인터페이스 및 서버 측 응용 프로그램으로 구성됩니다. 소프트웨어의 모든 부분은 통합되어 있으며 모든 기능은 한 곳에서 관리됩니다.
모놀리식 소프트웨어의 구조를 자세히 살펴보자.
모놀리식 아키텍처는 소규모 팀이 작업하기에 편하므로 많은 신생 기업이 앱을 만들 때 이 방법을 선택 합니다.
모놀리식 소프트웨어의 구성 요소는 상호 연결되고 상호 의존적이므로 소프트웨어가 자체 포함되도록 도와졸니다. 이 아키텍처는 응용 프로그램을 구축하기 위한 전롱적인 솔루션이지만 일부 개발자는 구식이라고 생각합니다. 그러나 우리는 모놀리식 아키텍처가 어떤 상황에서는 완벽한 솔루션이라고 생각합니다.


## SOA(sersvice-oriented architecture)

MSA와 SOA는 유사한 개념 때문에 혼동하기 쉽습니다. 다만 둘의 근본적인 차이점은 범위입니다. 
SOA는 전사적인 아키텍처 접근 방식이며, MSA는 어플리케이션 개발 팀 내의 구현 전략입니다.
또한 각각의 구성 요소와 롱신하는 방법에서 차이가 있습니다. SOA는 ESB를 사용하는 반면에 마이크로서비스끼리는 언어의 제약이 없는 API를 롱해 stateless 방식으로 롱신합니다. 마이크로서비스의 API에는 언어의 제약이 없기 때문에 개발팀에서 사용하고 싶온 툴을 선택할 수 있습니다. 따라서, 
마이크로서비스의 내결합성과 유연성이 더 유연합니다.
서비스 지향 아키텍처(SOA)는 서비스라는 소프트웨어 구성 요소를 사용해 비즈니스 애둘리케이션을 
생성하는 소프트웨어 개발 방식입니다. 각 서비스는 비즈니스 기능을 제공하며, 툴랫풍과 언어롤 넘나 
들여 서로 룡신할 수 있습니다. 개발자는 SOA를 사용해 서로 다른 시스템 내의 서비스를 재사용하거 
나 독립적인 여러 서비스를 결합하여 복잡한 태스크를 수행합니다.
예를 돌어 조직 내의 여러 비즈니스 프로세스에서 사용자 인증 기능이 필요할 경우, 모든 비즈니스 프 
로세스에 대해 인증 코드를 재작성하는 대신에 단일 인증 서비스를 생성해서 모든 애콜리케이션에 재 
사용할수 있습니다. 마찬가지로, 어떤 의료 기관 내에 있는 환자관리 시스템 및 전자 건강 기록(EHR) 
시스템과 같온 거의 모든 시스템에서 환자를 등록해야 하는 경우 해당 시스템돌이 하나의 공롱 서비스 
를 호출하여 환자 등록 태스크률 수형할 수 있습니다.

## 쿠팡 MSA 사례 > 2013년까지 모놀리틱 아키텍처 적용

모놀리틱 장점 - 적은 비용으로 빠르게 적용할 수 있는! 

## 쿠팡 MSA 사례 > 모놀리틱 git 저장소 구조

이 설계는 비즈니스 초기 단계에서 우리에게 효과가 있었지만 사용자 수와 데이터 양이 수년에 걸쳐 기하 급수 적으로 증가함에 따라 모놀리식 아키텍처로 인해 5 가지 중요한 문제가 발생했습니다. 

## 쿠팡 MSA 사례 > 모놀리틱 5가지 문제점 발생

1. 확장성 리스크 및 신뢰성
모놀리식 아키텍처의 일접하게 결합된 특성으로 인해한 구성 요소의 오류는 종종 다른 구성 요소로 이어지고 전체 시스템의 중단을 초래했습니다. 예를들어 Order 구성 요소에서 메모리 오류가 발생한 코드로 인해 전체 서버의 메모리 오류가 발생했습니다.사소한코드 오류나 트래픽 급증으로 인해 심각한 서버 및 서비스 장애가 발생발 수 있습니다

2. 관심사 분리 실패
Git 저장소에는 유지 보수의 편의를 위해 여러 팀에서 사용되는 공통 모듈이 수집된 쿠페 공롱 지점이 있었습니다. 그러나 우리의 엔지니어링 조직이 성장함에 따라 쿠팡 공통의 코드는 레거시 코드가되었습니다. 사용중인 코드 블록과 사용하지 않온 코드 블록을 구별하는 것이 어려워졌으며 관리 규칙이 좋지 않았습니다. 단일 메소드를 편집하려면 엔지니어가 전사적으로 전자 메일을 발송해야 했습니다.엔지니어들은 단순히 코드 블록을 복사하여 훨씬 더 크고 혼란스러운 코드베이스틀 만들었습니다.

3. 확장성 부족
모놀리식 아키텍처에서 스케일 아웃온 전체 플랫폼을 스케일 아웃합니다，
이는 전체 시스템을 확장하기 위해 추가 서버를 확보함으로써 높온 비용으로 달성될 수 있지만，이러한 확장 방법은 비용이 많이 들 뿐만 아니라 비효율적이다. 단순히 서버 인스턴스의 수를 확장한다고 해서 병목 현상을 일으키는 아키텍처의 근본적인 문제가 해결되는 것온 아니다.병목 현상의 구체적인 예는 다음 두 가지 통증 점에서 논의됩니다.

4. 효율적인 테스트를 위한 비용증가
보안상의 이유로 엔지니어는 모든 새로운 기능에 대해 단위 및 회귀 테스트를 실행합니다. 코드에 대한 크고 
작은 수정온 모두 전체 코드베이스틀 실행하여 테스트되었습니다.우리의 코드베이스와 기눙의 수가 증가함 
에 따라, 아주 작온 수정조차도 태스트 비용이 상당히 증가했다.

5. 비효율적인 서비스 배포
서비스 배포 과정에서도 같온 이유로 병목 현상이 발생했다. 이전에는 안전하고 질서 있는 배포를 위해 배포 플래그를 사용했습니다. 배포 플래그가 있는 팀만 코드베이스를 수정하고 배포할 수 있습니다. 그러나 수백 명의 엔지니어가 우리와 합류하고 매일 수십 개의 기능이 개발되고 수정됨에 따라 배포가 크게 지연되어 단일 코드 라인을 편집 한 엔지니어가 배포하기 위해 3일을 기다려야했습니다.

그래서 쿠팡은 MSA로 전환하기 시작했다. 


# <카카오페이 MSA 사례>

##  각 서비스들이 모놀리틱으로 구성 

성장율 위해 달려오느라 거대해진 이모티콘 서비스와 그만큼 많이 상인 기술 부재롤 두고, 천년만년 행복하게 개발하려는 구성원晉이 선택한 MSA.
기존 레거시 서비스가 단일 서버로 너무 큰 코드 베이스와 기눙옳 가지고 있어，이것옳 분IT하려는 목적과 MSA에서 추구하는 다양한 장점晉옳 옵수하기 위해 MSA 기반으로 다양한 기술콜옳 시도하고 있습니다.
저희 팀에서 개발하는 서비스는 크개, 이모티콘 서비스，이모티콘 스튜디오 서비스와 각 서비스를 운영하는 Admin 서비스로 나누어집니다. 둘론 이 외에 다른 서비스晉이 있지만 이 큰 4가지가 주된 서비스晉입니다.
이 중에서 이모티콘 서비스가 가장 큰 서비스로, 가장 오래된 이모티콘의 역사가 담겨있습니다.
각 대규모 서비스晉온 모놀리스 형태로 각각 서비스 운영이 되고 있고, 이미 눈치재신 분晉도 계시겠지만 
Play 1.2.7처럼 오래된 프레임워크에서 아직 살아남아있습니다. Java 7音 사용하고 있고 admin 暑온 빠른 운영 기눙 대응몰 위해 선택 되었올 거라고 에측되는 Ruby on Rails를 사용하고 있습니다. 저희에게는 청산대상입니다.

## 모놀리틱 3가지 문제점 
1. 서비스 배포가 어려움 

2. 코드 버전관리 복잡도가 높음 

하나의 서버에 많은 기능이 모여있다 보니 여러 개발자가 같은 저장소에 여러 브랜치를 만들어 작업하게 됩니다. 이러다보니 누가 먼저 머지 되느냐에 따라 code confilict

3. 서비스가 너무 커지다보니 변경하기가 어려움 

## MSA로 전환 
이렇게 저희 팀은 Api gateway를 넣어둔 이후에 뒤로 서비스를 계속 분리해 나가고 있습니다. 

## MSA 적용 후 개선된 점
1. 업무 역할 분담이 명확해졌다. 

2. 배포의 부담이 많이 낮아졌다. 

3. 신규 서비스 기능 추가가 쉽다.

## MSA 적용 후 힘들어진점
1. 설계 제약 사항과 고민들이 늘어난다. 

2. 개인이 담당할 서비스가 늘어난다.

서비스라는 것은 동기부여가 많이 되고, 뿌듯함도 있지만 그만큼의 불안감이 존재한다. 

3. 서비스가 도메인 지식 공유가 힘들다. 

담당자별로 업무가 고립이 되어 독박 타임을 맞이한다. 팀원들이 번아웃이 온다. 

내가 아니면 이걸 운영할 수 없다 라는 것은 연봉협상이다. 

## MSA 적용이 가능했던 이유 
개선할려고 하는 팀 분위기

카카오에서는 어떤 기술을 논의했을 떄 자연스럽게 공유가 되고 문제점에 대해 얘기하게 되는데 개발 문화가 없는 회사가 오니까 말이 안통하더라. 대화하고 같이 성장할 수 있는 사람들 .. 힘들게 이 시간까지 공부하고 특강을 하는 것이 좋은 곳에 가기 위함이다. 

## MSA 적용이 정말 답인가? 
결국 우리가 해결해야 하는 문제의 정의가 정확하게 되어야, 그에 맞는 설계를 할 수 있어 현장조사가 제일 중요하다. 

# 우아한 형제들 MSA 사례 

## 최초 모놀리틱으로 개발
모든 메뉴들을 루비기반의 MSA로 했다 
코로나 이후로 J커브를 이루며 빠른 성장을 이루어냈다. 주문 수 가 커지면서 트래픽이 몰리게 됐다. 

배달의 민족은 대장애시대를 맞이해서, MSA로 전환을 시도했다. 2019년에 모든 ㅣ스템이 분리되며 마이크로 서비스가 완성되고 시스템의 안정화를 찾을 수 있었다. 

## 대장애를 맞고 MSA로 변환

요즘에는 대기열 시스템을 사용하기도 한다. 

주문이 싹 들어가면, 몇번째 인지 알기 떄문에, 안정감이 들고, 개발자 입장에서는 고객이 주문 트래픽으로 접근하지 않아서 서버 과부하가 안든다. 

쿠팡이나 배민이 MSA로 가면서 성장을 할 수 있었던 이유는 투자를 많이 받고, 잘하는 개발자들을 대규모로 채용했기 떄문이기도 하다. 경험이 많은 개발자들을 채용하면서 서비스를 개발해서 모든것이 잘 맞아 성공했다.

# 이커머스 MSA 설계하기 (예시. 이마트) 
후기, 리뷰, 재고, 금액, 검색, 이벤트, 선물하기 -

이걸 만약 모놀리틱으로 한다면? 리뷰는 파이썬 이벤트는 스칼라 식으로 선택하고 DB를 물리적으로 나눌 것인가도 고민할 수 잇다. 

각각의 서비스를 네모박스로 그려서 분리하고, 깃헙의 레파지토리, 언어는 뭘로 할껀지 슬라이드 처럼 비슷하게 하는 것을 지금부터 해보자. 

## 실습 시작 

잼보드 - 

사용자가 많이 쓰지 않는 것들은 한군데 두고 트래픽이 많은 기능들은 아예 분리를 한다. 좋아요나 선물함 같은 어느정도의 트래픽, 회원자수는 없다. 자연스럽게 회의를 통해서 좋아요는 나눠야 될 것 같습니다. 사용자 수가 몇명이고 많은 소스 코드가 개발되어있기 떄문에 종속성을 끊어야 합니다 라고 하고 하기도 한다. 수요에 따라서 서비스를 분리할 꺼냐, 말꺼냐 고민한다. 또 도메인에 따라서 나누기도 하고, 회사마다 다를 수도 있다. 한번 고민해보자. 
